FROM node:20-alpine AS build

WORKDIR /app/frontend

COPY frontend/package*.json ./

RUN npm install

COPY frontend ./

RUN npm run build

# Production stage - Caddy serves static files AND proxies API/socket to backend
FROM caddy:2-alpine

COPY --from=build /app/frontend/dist /srv
COPY Caddyfile.docker /etc/caddy/Caddyfile

EXPOSE 3000
