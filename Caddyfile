// Caddy Reverse Proxy Configuration
// Place this in /etc/caddy/Caddyfile

racing-game.example.com {
    # Proxy to frontend
    reverse_proxy /api* localhost:3001 {
        header_uri /api /api
    }

    # Proxy WebSocket
    reverse_proxy /socket.io* localhost:3001 {
        header_Connection "Upgrade"
        header_Upgrade "websocket"
    }

    # Serve frontend
    reverse_proxy localhost:3000

    # Enable compression
    encode gzip

    # Cache headers
    @static {
        path *.js *.css *.png *.jpg *.jpeg *.svg *.gif *.woff *.woff2
    }
    header @static Cache-Control "public, max-age=31536000, immutable"

    # Security headers
    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Rate limiting (optional)
    # rate_limit {
    #     zone dynamic http://localhost:3001 100
    # }
}
